<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>CTools context tutorial</title>
        <meta name="viewport" content="width=device-width">

        <link rel="stylesheet" href="/css/main.3e33.css"/>

        <link href='http://fonts.googleapis.com/css?family=Abril+Fatface' rel='stylesheet' type='text/css'>

        <!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-6558346-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


    </head>
    <body>

    

    <header class="white">
      <div class="container">
        <div class="logo"><a href="/">gizra</a></div>
        <nav id="nav" role="navigation" class="navbar navbar-default nav-fixed">
          <div class="navbar-header">
            <button data-target=".navbar-collapse" data-toggle="collapse" class="navbar-toggle" type="button">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
          </div>
          <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
              <li><a href="/products">Products</a></li>
              <li><a href="/#about">About</a></li>
              <li><a href="/#work">Work</a></li>
              <li><a href="/#code">Showcase</a></li>
              <li><a href="/blog" class="active">Blog</a></li>
              <li><a href="/#contact">Contact</a></li>
            </ul>
          </div>
        </nav>
      </div> <!-- End of container -->
    </header>

    


    
  



  
    
      
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  


<section id="post-page">
  <div class="background">
    <img src="/images/post/background.71f5.png">
  </div>

  <div class="ballons"></div>
  <div class="post-back">
    <a href="/blog">
      <img src="/images/post/post-back.fca6.png">
    </a>
  </div>

  <div class="content">
    <div class="container">
      <div class="row">

        <div class="col-md-8 col-md-offset-2 post">
          <div class="row">
            <div class="post-label">
              <a href="/content/ctools-context-tutorial/">CTools context tutorial</a>
            </div>
          </div>

          <div class="row small-row">
            <div class="date">11 May 2011</div>
            <div class="seprator">|</div>
            <div class="author">By Amitai Burstein</div>
          </div>

          <div class="row small-row">
            <div class="tags">

              
              <ul class="inline">
                
                

  
    
      <li><a href="/tags.html#Drupal-planet-ref">Drupal-planet</a></li>
    
      <li><a href="/tags.html#tutorial-ref">tutorial</a></li>
    
      <li><a href="/tags.html#CTools-ref">CTools</a></li>
    
  


              </ul>
              
            </div>

            <div class="comments-count"><a href="http://www.gizra.com/content/ctools-context-tutorial/#disqus_thread"></a></div>
          </div>

          <div class="row">
            <div class="post-content">
              <p>Why should you use panels node-preview-example module? You shouldn&#39;t, it&#39;s just an example ;)</p>

<p>This post covers how to build a CTools content-type plugin that has context. CTools &quot;Context&quot; should not be mistaken with the context module. Context is CTools way of saying, my plugin (read, block) shouldn&#39;t be dumb. If it requires a node or a user to extract data from, then it should let others know about it. &quot;Others&quot; in our case is Page manager module. It will load the context for the plugins and hand it over. In fact, if the context is not present it will not even bother loading the plugin.</p>

<p>I have created an example module called node-preview-example, that you can simply download and enable, create an Article page, and see how Panels is now showing the body field on the left and on the right a (silly) &quot;Summary&quot; of the node -- this is our plugin.</p>

<!-- more -->
<div class="highlight"><pre><code class="text language-text" data-lang="text">drush dl ctools panels features
drush en ctools page_manager panels features
</code></pre></div>
<p>And the example module is in my <a href="http://drupal.org/sandbox/noam.hrz/1148086">sandbox</a>:
<code>
git clone http://git.drupal.org/sandbox/noam.hrz/1148086.git node_preview_example
</code></p>

<p>Let&#39;s go over the important parts in the code.</p>
<div class="highlight"><pre><code class="php language-php" data-lang="php"><span class="cp">&lt;?php</span>

<span class="sd">/**</span>
<span class="sd"> * Plugin definition.</span>
<span class="sd"> */</span>
<span class="nv">$plugin</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
  <span class="o">...</span>

  <span class="s1">&#39;required context&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
    <span class="k">new</span> <span class="nx">ctools_context_required</span><span class="p">(</span><span class="nx">t</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">),</span> <span class="s1">&#39;user&#39;</span><span class="p">),</span>
    <span class="k">new</span> <span class="nx">ctools_context_required</span><span class="p">(</span><span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Node&#39;</span><span class="p">),</span> <span class="s1">&#39;node&#39;</span><span class="p">),</span>
  <span class="p">),</span>
  <span class="o">...</span>
<span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>The plugin definition  is where we let the system know we need a user object and a node object to operate on.</p>

<p>Next the render callback can use those context, after making sure they are valid.</p>
<div class="highlight"><pre><code class="php language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="sd">/**</span>
<span class="sd"> * Render callback.</span>
<span class="sd"> */</span>
<span class="k">function</span> <span class="nf">node_preview_example_summary_content_type_render</span><span class="p">(</span><span class="nv">$subtype</span><span class="p">,</span> <span class="nv">$conf</span><span class="p">,</span> <span class="nv">$args</span><span class="p">,</span> <span class="nv">$context</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Seperating the context to two different variables</span>
  <span class="k">list</span><span class="p">(</span><span class="nv">$user_context</span><span class="p">,</span> <span class="nv">$node_context</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$context</span><span class="p">;</span>

  <span class="c1">// Make sure that context variable arent empty.</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$user_context</span><span class="p">)</span> <span class="o">||</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$user_context</span><span class="o">-&gt;</span><span class="na">data</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$node_context</span><span class="p">)</span> <span class="o">||</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$node_context</span><span class="o">-&gt;</span><span class="na">data</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Above we made sure we got the context.</span>
  <span class="nv">$node</span> <span class="o">=</span> <span class="nv">$node_context</span><span class="o">-&gt;</span><span class="na">data</span><span class="p">;</span>

  <span class="o">...</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>As you can see, it didn&#39;t take much to get the context working, but it gives a lot of power:</p>

<ul>
<li>Plugins without satisfied context will not appear in the plugins list, so a user can't add them by mistake</li>
<li>There is one single way for plugins to get a context, unlike "dumb" blocks that each one needs to find out where they are (e.g. ``menu_get_item()`` over and over again).</li>
</ul>

<p>If you listen to talks about Butler module, and having a plugin and context system in D8 - it will probably very similar or at least learn a lot from CTools plugins and context system, so you know you are on the right path.</p>

            </div>
          </div>

          <div class="row">
            <div class="bottom-dash"></div>
          </div>

          <div class="row post-nav">
            <div class="first">
              
              <div class="previous">
                <a href="/content/data-migration-part-2/">
                  Previous
                </a>
              </div>
              <a href="/content/data-migration-part-2/" class="prev-text">
                Data Migration - part 2
              </a>
              
            </div>
            <div class="last">
              
              <div class="next">
                <a href="/content/og-7x-11-rc2-out/">
                  Next
                </a>
              </div>
              <a href="/content/og-7x-11-rc2-out/" class="next-text">
                OG 7.x-1.1-RC2 is out! 
              </a>
              
            </div>
          </div>

          <div class="row author-details">
            <div class="image-wrapper">
              <img src="/images/team/amitaibu.4179.jpg" class="img-responsive">
            </div>
            <div class="text-wrapper">
              <span class="name">Amitai Burstein</span> <span class="twitter">(@amitaibu)</span>
              <div class="title">CTO, Co-Owner</div>
              <div class="bio">Maintainer of Organic groups, the Message stack, and co-maintainer of Drupal 8's Entity reference. <a href="/content/the-about-story/">The about story</a>.</div>
            </div>
          </div>

          <div class="row">
            <div class="bottom-dash-small"></div>
          </div>

          <div class="row">
            <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'gizra';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

          </div>

        </div>
      </div>
    </div>
  </div>
</section>

<script type="text/javascript">
var disqus_shortname = 'gizra';

/* * * DON'T EDIT BELOW THIS LINE * * */
(function () {
var s = document.createElement('script'); s.async = true;
s.type = 'text/javascript';
s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>




    <script src="/js/plugins.5250.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script>

    <script src="/js/scripts.87fd.js"></script>

    </body>
</html>
