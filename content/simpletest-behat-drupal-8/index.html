<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        
    

<title>simpleTest with Behat for Drupal 8</title>

        <meta name="description" content="">
        <meta name="keywords" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <!-- Favicon for all platforms -->
      <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon-180x180.5691.png">
      <link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.c391.png" sizes="32x32">
      <link rel="icon" type="image/png" href="/images/favicons/favicon-194x194.e5f8.png" sizes="194x194">
      <link rel="icon" type="image/png" href="/images/favicons/favicon-96x96.8557.png" sizes="96x96">
      <link rel="icon" type="image/png" href="/images/favicons/android-chrome-192x192.17e1.png" sizes="192x192">
      <link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.7353.png" sizes="16x16">
      <link rel="manifest" href="/images/favicons/manifest.json">
      <meta name="msapplication-TileColor" content="#000000">
      <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
      <meta name="theme-color" content="#ffffff">
      <!-- End favicon for all platforms -->

      <link rel="stylesheet" href="/css/main.b4f8.css"/>
      <link href='http://fonts.googleapis.com/css?family=Abril+Fatface&text=gizra' rel='stylesheet' type='text/css'>
      <link href='https://fonts.googleapis.com/css?family=Hind:400,600,300,500' rel='stylesheet' type='text/css'>
      <link href='https://fonts.googleapis.com/css?family=Raleway:400,300,600,800' rel='stylesheet' type='text/css'>
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
      <!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-6558346-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


      <!-- Begin Inspectlet Embed Code -->
      <script type="text/javascript" id="inspectletjs">
      window.__insp = window.__insp || [];
      __insp.push(['wid', 314054580]);
      (function() {
      function ldinsp(){if(typeof window.__inspld != "undefined") return; window.__inspld = 1; var insp = document.createElement('script'); insp.type = 'text/javascript'; insp.async = true; insp.id = "inspsync"; insp.src = ('https:' == document.location.protocol ? 'https' : 'http') + '://cdn.inspectlet.com/inspectlet.js'; var x = document.getElementsByTagName('script')[0]; x.parentNode.insertBefore(insp, x); };
      setTimeout(ldinsp, 500); document.readyState != "complete" ? (window.attachEvent ? window.attachEvent('onload', ldinsp) : window.addEventListener('load', ldinsp, false)) : ldinsp();
      })();
      </script>
      <!-- End Inspectlet Embed Code -->

    </head>
    <body>

    <!-- Main content -->
    
  



  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
      
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  


<div id="post-page">
  <header id="header-post">
    <div class="container">
      <div class="row">
        <div class="col-sm-10 col-sm-offset-1">
          
  

<nav id="nav" role="navigation" class="navbar navbar-default">
  <div class="navbar-header">
    <button data-target=".navbar-collapse" data-toggle="collapse" class="navbar-toggle" type="button">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
  </div>
  <div class="navbar-collapse collapse">
    <ul class="nav navbar-nav">
      <li><a href="/#about" class="smooth-scroll-to">About Us</a></li>
      <li><a href="/team">Meet the Team</a></li>
      <li><a href="/blog">Blog</a></li>
      <li><a href="#contact" class="smooth-scroll-to">Contact</a></li>
    </ul>
  </div>
</nav>

  <h2 class="gizra-logo"><a href="/">gizra</a></h2>



        </div>
      </div>
    </div>
  </header>

  <div class="content-container">
    <article class="post">
      <h1><a href="/content/simpletest-behat-drupal-8">simpleTest with Behat for Drupal 8 </a></h1>
      <div class="date">28 Apr 2015, By Roy Segall</div>
      <div class="tags">
        <img src="/images/post/tag-icon-small.15a8.png" class="tags-icon"/>
        <ul class="inline">
          
          

  
    
      <li><a href="/tags.html#Behat-ref">Behat</a></li>
    
      <li><a href="/tags.html#PHPunit-ref">PHPunit</a></li>
    
      <li><a href="/tags.html#QA-ref">QA</a></li>
    
      <li><a href="/tags.html#Drupal-planet-ref">Drupal-planet</a></li>
    
  


        </ul>
        </div>
      <div class="post-content">

        <p>The first time I heard about <a href="http://docs.behat.org/en/v2.5/">Behat</a> was at DrupalCon Munich 2012. Since then use of Behat has grown exponentially and the tools it can be integrate with grew as well. With Behat we can test the markup of a page - pretty neat, right?  </p>

<p>Well, it&rsquo;s time to take Behat integration with Drupal a little further. I&rsquo;ve decided to try and integrate it with Drupal&rsquo;s simpleTest, as this would open the door for writing simpleTests that are more readable and more &ldquo;behavior driven&rdquo; by nature.</p>
<div class="highlight"><pre><code class="Gherkin language-Gherkin" data-lang="Gherkin"><span class="k">Scenario:</span><span class="nf"> Testing the login form.</span>
<span class="k">  Given </span><span class="nf">I visit &#39;user&#39;</span>
<span class="nf">    </span><span class="k">And </span><span class="nf">I fill in &#39;Username&#39; with &#39;@user-name&#39;</span>
<span class="nf">    </span><span class="k">And </span><span class="nf">I fill in &#39;Password&#39; with &#39;@user-pass&#39;</span>
<span class="nf">   </span><span class="k">When </span><span class="nf">I press &#39;Log in&#39;</span>
<span class="nf">   </span><span class="k">Then </span><span class="nf">I should see &#39;@user-name&#39;</span>
</code></pre></div>
<p>Amazingly enough, the above Gherkin code which is being executed by PHPunit can test your Drupal installation!</p>

<div class="thumbnail">
  <div class="img-wrapper">

    

    
      <img src="http://www.gizra.com/assets/images/posts/behat-drupal8/test_results.png">
    

  </div>
  
    <div class="caption">Behat code executed from within Drupal&rsquo;s simpleTest</div>
  
</div>

<p>This functionality is provided by an experimental <a href="https://github.com/RoySegall/behat">repo</a>, which comes with an example test.</p>

<!-- more -->

<h2>The Implementation</h2>

<p>The step definition mechanism discovers the methods it needs to invoke by reading the annotation on the class. In order to get the same flexible functionality the <code>I visit &quot;login&quot;</code> is translated to the following annotated class:</p>
<div class="highlight"><pre><code class="php language-php" data-lang="php"><span class="cp">&lt;?</span> <span class="nx">php</span>
<span class="c1"># src/Plugin/Step/Visit.php</span>

<span class="c1">// ..</span>

<span class="sd">/**</span>
<span class="sd"> * @Step(</span>
<span class="sd"> *  id = &quot;I visit &#39;(.*?)&#39;&quot;</span>
<span class="sd"> * )</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">Visit</span> <span class="k">extends</span> <span class="nx">BehatStepAbstract</span> <span class="p">{</span>

  <span class="k">public</span> <span class="k">function</span> <span class="nf">step</span><span class="p">(</span><span class="nx">BehatTestsAbstract</span> <span class="nv">$behat</span><span class="p">,</span> <span class="nv">$url</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$behat</span><span class="o">-&gt;</span><span class="na">visit</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Each placeholder <code>(.*?)</code> will be passed as additional argument. The <code>$Behat</code>
object is an instance of <code>BehatTestsAbstract</code> which allows us to invoke the methods of the simpletest class.</p>

<h2>Making it work</h2>

<p>We know how Behat works, how to define a test and that we need to write a feature file. But how can we run it? Letâ€™s see the commented code on how the login tests work:</p>
<div class="highlight"><pre><code class="php language-php" data-lang="php"><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">Login</span> <span class="k">extends</span> <span class="nx">BehatTestsAbstract</span> <span class="p">{</span>

  <span class="k">public</span> <span class="k">function</span> <span class="nf">testLogin</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Create a user.</span>
    <span class="nv">$account</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">drupalCreateUser</span><span class="p">();</span>
    <span class="nv">$this</span>
      <span class="c1">// Populate the behat arguments. Pass the username and password.</span>
      <span class="o">-&gt;</span><span class="na">setPlaceholder</span><span class="p">(</span><span class="s1">&#39;@user-name&#39;</span><span class="p">,</span> <span class="nv">$account</span><span class="o">-&gt;</span><span class="na">label</span><span class="p">())</span>
      <span class="o">-&gt;</span><span class="na">setPlaceholder</span><span class="p">(</span><span class="s1">&#39;@user-pass&#39;</span><span class="p">,</span> <span class="nv">$account</span><span class="o">-&gt;</span><span class="na">passRaw</span><span class="p">)</span>
      <span class="c1">// As each feature file could contain a bunch of scenario and we might</span>
      <span class="c1">// want to run tests with different tags.</span>
      <span class="c1">// This will make sure only scenarios with the `@login-success` tag will</span>
      <span class="c1">// run.</span>
      <span class="o">-&gt;</span><span class="na">setTag</span><span class="p">(</span><span class="s1">&#39;@login-success&#39;</span><span class="p">)</span>
      <span class="c1">// Execute the correct scenario.</span>
      <span class="o">-&gt;</span><span class="na">executeScenario</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;behat&#39;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="k">function</span> <span class="nf">testLoginFailed</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setTag</span><span class="p">(</span><span class="s1">&#39;login-failed&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">executeScenario</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;behat&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Lets have a look at the following:</p>
<div class="highlight"><pre><code class="php language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">executeScenario</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;Behat&#39;</span><span class="p">);</span>
</code></pre></div>
<p>The first argument will be the name of the file, in our example <code>login.feature</code><br>
The second argument is the module. This tells us which module contains the feature files, so in theory even themes could provide their own tests and step definitions.</p>

<h2>Next steps</h2>

<p>In Drupal Dev Days 2015 quite a few people showed interest in this. Even if it won&rsquo;t be used by the vast majority, I still feel experiments such as this one help us explore more options, and find better tools for better QA.</p>

<p>My plan for the future is to to completely eliminate the need for <code>executeScenario</code>, thus allow having a feature file without a Drupal class, while still being able to use all the step definitions provided by other modules and themes.</p>


      </div>
    </article>
    <section class="post-nav">
      <div class="row">
        <div class="col-xs-6 previous">
          
          <div class="text-capitalize">
            <a href="/content/shoov-ci-tests-live-site">
              Previous
              <span class="visible-xs"> post</span>
            </a>
          </div>
          <a href="/content/shoov-ci-tests-live-site" class="prev-text">
            <span class="hidden-xs">Shoov - CI tests on the live site</span>
          </a>
          
        </div>
        <div class="col-xs-6 next">
          
          <div class="text-capitalize">
            <a href="/content/cross-browser-visual-regression-with-shoov">
              Next
              <span class="visible-xs"> post</span>
            </a>
          </div>
          <a href="/content/cross-browser-visual-regression-with-shoov" class="next-text">
            <span class="hidden-xs">Cross Browser Visual Regression Tests With Shoov</span>
          </a>
          
        </div>
      </div>
    </section>
    <section class="author-details">
      <div class="image-wrapper">
        <img src="/images/team/avatars/RoySegall.c400.jpg" class="img-circle img-responsive">
      </div>
      <div class="text-wrapper">
        <span class="name">Roy Segall</span>
        
        <div class="title">Team Lead</div>
        <div class="bio">Not afraid of patching Organic groups, Entity reference or the Message stack. Knows how to make tasty Pizza.</div>
      </div>
    </section>
    <section>
      <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'gizra';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    </section>
  </div>
</div>


    <!--Footer -->
    
  <div id="contact">
    <footer id="footer">
      <div class="footer-wrapper">
        <div class="background">
          <div class="container">
            <div class="row">
              <div class="col-sm-12">
                <h2 class="title">Talk to us</h2>
                <div class="clearfix">
                  <address>
                    <div class="strong">Israel Headquarters</div>
                    <span>5 Brenner Street, Tel Aviv</span>
                      <a class="telephone" href="tel:+97233731222">+972-3-3731222</a>
                    <a class="email" href="mailto:info@gizra.com">info@gizra.com</a>
                  </address>
                  <address class="separator">
                    <div class="strong">North America Office</div>
                    <span>157 Columbus Avenue, 4th Floor, New York, NY 10023</span>
                    <a class="telephone" href="tel:+13476864508">347-686-4508</a>
                    <a class="email" href="mailto:usoffice@gizra.com">usoffice@gizra.com</a>
                  </address>
                  <div class="separator social-links">
                    <span class="link github">
                      <a href="https://github.com/Gizra" target="_blank" title="Gizra's Github Account"><i class="fa fa-github-square"></i></a>
                    </span>
                    <span class="link twitter">
                      <a href="https://twitter.com/gizra_drupal" target="_blank" title="Gizra's Twitter Account"><i class="fa fa-twitter-square"></i></a>
                    </span>
                    <span class="link linkedin">
                      <a href="https://www.linkedin.com/company/gizra-ltd" target="_blank" title="Gizra's LinkedIn Page"><i class="fa fa-linkedin-square"></i></a>
                    </span>
                    <span class="link facebook">
                      <a href="https://www.facebook.com/gizraltd/timeline" target="_blank" title="Gizra's Facebook Page"><i class="fa fa-facebook-square"></i></a>
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </footer>
  </div>



    <script src="/js/plugins.7686.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script>

    <script src="/js/scripts.1fc2.js"></script>
    </body>
</html>
