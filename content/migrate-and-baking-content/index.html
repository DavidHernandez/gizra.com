<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Migrate, and baking content</title>
        <meta name="description" content="">
        <meta name="keywords" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <!-- Favicon for all platforms -->
      <link rel="apple-touch-icon" sizes="57x57" href="/images/favicons/apple-touch-icon-57x57.b3df.png">
      <link rel="apple-touch-icon" sizes="60x60" href="/images/favicons/apple-touch-icon-60x60.a84d.png">
      <link rel="apple-touch-icon" sizes="72x72" href="/images/favicons/apple-touch-icon-72x72.664d.png">
      <link rel="apple-touch-icon" sizes="76x76" href="/images/favicons/apple-touch-icon-76x76.faf5.png">
      <link rel="apple-touch-icon" sizes="114x114" href=/"images/favicons/apple-touch-icon-114x114.png">
      <link rel="apple-touch-icon" sizes="120x120" href="/images/favicons/apple-touch-icon-120x120.d810.png">
      <link rel="apple-touch-icon" sizes="144x144" href="/images/favicons/apple-touch-icon-144x144.1807.png">
      <link rel="apple-touch-icon" sizes="152x152" href="/images/favicons/apple-touch-icon-152x152.71bf.png">
      <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon-180x180.a9f0.png">
      <link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.c391.png" sizes="32x32">
      <link rel="icon" type="image/png" href="/images/favicons/favicon-194x194.e5f8.png" sizes="194x194">
      <link rel="icon" type="image/png" href="/images/favicons/favicon-96x96.8557.png" sizes="96x96">
      <link rel="icon" type="image/png" href="/images/favicons/android-chrome-192x192.0b72.png" sizes="192x192">
      <link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.7353.png" sizes="16x16">
      <link rel="manifest" href="/images/favicons/manifest.json">
      <meta name="msapplication-TileColor" content="#000000">
      <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
      <meta name="theme-color" content="#ffffff">
      <!-- End favicon for all platforms -->

      <link rel="stylesheet" href="/css/main.20eb.css"/>
      <link href='http://fonts.googleapis.com/css?family=Abril+Fatface' rel='stylesheet' type='text/css'>
      <link href='https://fonts.googleapis.com/css?family=Hind:400,600,300,500' rel='stylesheet' type='text/css'>
      <link href='https://fonts.googleapis.com/css?family=Raleway:400,300,600,800' rel='stylesheet' type='text/css'>
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
      <!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-6558346-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->

              
    </head>
    <body>
    <!-- ClickTale Top part -->
    <script type="text/javascript">
    var WRInitTime=(new Date()).getTime();
    </script>
    <!-- ClickTale end of Top part -->

    <!-- Main content -->
    
  



  
    
      
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  


<div id="post-page">
  <header id="header-post">
    <div class="container">
      <div class="row">
        <div class="col-sm-10 col-sm-offset-1">
          <nav id="nav" role="navigation" class="navbar navbar-default">
  <div class="navbar-header">
    <button data-target=".navbar-collapse" data-toggle="collapse" class="navbar-toggle" type="button">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
  </div>
  <div class="navbar-collapse collapse">
    <ul class="nav navbar-nav">
      <li><a href="/team">Meet the team</a></li>
      <li><a href="/blog">Blog</a></li>
      <li><a href="#contact" class="smooth-scroll-to">Contact</a></li>
    </ul>
  </div>
</nav>


  <h2 class="gizra-logo"><a href="/">gizra</a></h2>



        </div>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="row">
      <div class="col-sm-10 col-sm-offset-1">
        <article class="post">
          <h1><a href="/content/migrate-and-baking-content/">Migrate, and baking content </a></h1>
          <div class="date">27 Dec 2012, By Amitai Burstein</div>
          <div class="tags">
            <img src="/images/post/tag-icon-small.15a8.png" class="tags-icon"/>
            <ul class="inline">
              
              

  
    
      <li><a href="/tags.html#Drupal-planet-ref">Drupal-planet</a></li>
    
      <li><a href="/tags.html#Migrate-ref">Migrate</a></li>
    
  


            </ul>
            </div>
          <div class="post-content">

            <p>A small problem in Drupal occurs when developing new modules, or installation profiles. Content.
It goes missing, and without it developing can go wrong very quickly. Also, starting up a site’s install profile that reveals a site without content gives a feel of walking into an empty bakery shop. There’s ovens, flour, and bakers, and that great bakery smell all around, but no bread. And possible clients go to other bakeries if you run out of bread. So to solve this issue, <a href="http://drupal.org/project/migrate">Migrate</a>  module helps us fill up the shop with bread.
Oh, and you can also migrate data from other (older) sites.</p>

<!-- more -->

<h3>What is it good for?</h3>

<p>Migrate fills up your Drupal installation profile, or just fresh new module, with appropriate content that helps the user or developer experiment with it, so the new module’s learning curve is easier. When developing, if you mess something up - say, drop the user table - it won’t be as bad as it could’ve been, since you kept around a backup in a CSV file. Some company want their site upgraded? No problem. Migrate can import from CSV, SQL databases, XML and much more.</p>

<p>_For the less technical: if you think I&#39;m just naming random letters, relax: if you have Microsoft Excel, or even OpenOffice (it&#39;s free!), you can start creating content before you even have a site. Just open up a new table in either software, and save it as a CSV file. Your developer should be able to guide you through in a few minutes. If he can’t, well, you might want to consider a different one.</p>

<p>Migrate provides a strong advantage when developing installation profiles. When you rebuild a profile, the existing database is thrown away and replaced with a new one. But most of the time, you will need content to work with, test your logic, and see the resulting displayed page. With Migrate, when you install a profile, you can automatically import content to work with.</p>

<p>Also, Migrate is great for it’s obvious main purpose - to migrate sites’ content to a drupal installation. This is great if you’re building a site for a client that already has a working site but is looking for an upgrade and is afraid of losing all of the site’s content.</p>

<p>However, the best use of Migrate is during the initial development of a new site. Think of it like that: the bakery is still being built, but the baker can&#39;t wait to start baking. He has all those little recipes he&#39;s anxious to try, so in the meantime he prepares dough and keeps it in his household refrigerator.
The same principle occurs with Migrate: while Dave, the developer, is building on the structure of the database, content types and whatnots, Sam, the site&#39;s manager, can start creating content, and customize it&#39;s structure according to his needs. All Sam needs to do is create a table and save it in some Migrate-able format (like a CSV file) . This saves time for Sam till he can launch the site, since he can start preparing the content – and put the dough straight in the oven from the refrigerator, without hassling around with flour and eggs. The site will have a quicker &#39;cool down&#39; time between the development is finished until the site is actually launched, since the content is already stored and ready to be used.</p>

<p>Not only time is saved. Dave receives less stress from Sam while developing, since Sam is busy creating content for the new site. Confusion is reduced when Sam decides some content&#39;s structure needs to be altered during development (which occurs quite often) to better suit his needs. A more finely defined content is created as a result, better suited to Sam&#39;s needs, and with less last-minute fixes. A few lines of migration code and voila! Everything is ready for the newly structured content.</p>

<h3>So, how do I use Migrate?</h3>

<p>Data storage (a.k.a - Sam’s side of the story)
The migrate module reads information stored in .csv files. An example of one of these is shown below:</p>

<p><img src="/assets/images/legacy/s025.png" /></p>

<p>Notice that ‘company’ and ‘status’ columns are filled with references to other entities’ IDs.</p>

<p>That’s it for site developers. Create a table, make sure everything sits the way you want it, and send it to the developer.</p>

<h4>The Drupal side: (a.k.a - Dave’s side of the story)</h4>

<p>If you’re reading this, I’m assuming you are a Drupal developer (it’s quite technical from now on). I’ve written a simplified example, divided into parts. In this example, I’ve shown how to migrate content from CSV files. A complete, working example of an abstract migration class can be found <a href="https://github.com/Gizra/Garment-Box/blob/7.x-1.x/garmentbox/modules/custom/garmentbox_migrate/includes/garmentbox_migrate.migrate.entity.inc">here</a> - and in the same git repository there is a complete implementation of a custom Migrate module. All the CSV files under under a csv direcrory using a naming convention <code>csv/entity_type/bundle.csv</code>. Example of using this abstract class to import taxonomy terms is shown below:
&lt; img src=&quot;http://www.gizra.com/sites/default/files/s033.png&quot; /&gt;</p>
<div class="highlight"><pre><code class="php language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="sd">/**</span>
<span class="sd"> * Migrate measurement unit terms.</span>
<span class="sd"> *</span>
<span class="sd"> * Use garmentboxMigration class to import taxonomy terms.</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">garmentboxMeasurementUnitTerms</span> <span class="k">extends</span> <span class="nx">garmentboxMigration</span> <span class="p">{</span>

  <span class="c1">// Define entity type and bundle, used in garmentboxMigration.</span>
  <span class="k">public</span> <span class="nv">$entityType</span> <span class="o">=</span> <span class="s1">&#39;taxonomy_term&#39;</span><span class="p">;</span>
  <span class="k">public</span> <span class="nv">$bundle</span> <span class="o">=</span> <span class="s1">&#39;measurement_units&#39;</span><span class="p">;</span>

  <span class="c1">// Map columns to import. garmentboxMigration already mapped &quot;id&quot; and</span>
  <span class="c1">// &quot;name&quot;.</span>
  <span class="k">public</span> <span class="nv">$csvColumns</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;field_unit_type&#39;</span><span class="p">,</span>
    <span class="s1">&#39;field_conversion_ratio&#39;</span><span class="p">,</span>
  <span class="p">);</span>

  <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">();</span>
    <span class="c1">// Map the mapped columns to fields.</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">addFieldMapping</span><span class="p">(</span><span class="s1">&#39;field_unit_type&#39;</span><span class="p">,</span> <span class="s1">&#39;field_unit_type&#39;</span><span class="p">);</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">addFieldMapping</span><span class="p">(</span><span class="s1">&#39;field_conversion_ratio&#39;</span><span class="p">,</span> <span class="s1">&#39;field_conversion_ratio&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>And that’s it. <code>garmentboxMigration</code> takes care of stitching everything together, and putting the data in the content’s fields. You can obviously extend this abstract class to fit your own business logic.
Importing files and images is also easy:</p>

<p><img src="/assets/images/legacy/s029.png" /></p>
<div class="highlight"><pre><code class="php language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">addFieldMapping</span><span class="p">(</span><span class="s1">&#39;field_image&#39;</span><span class="p">,</span> <span class="s1">&#39;field_image&#39;</span><span class="p">);</span>
<span class="nv">$this</span>
  <span class="o">-&gt;</span><span class="na">addFieldMapping</span><span class="p">(</span><span class="s1">&#39;field_image:file_replace&#39;</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="na">defaultValue</span><span class="p">(</span><span class="nx">FILE_EXISTS_REPLACE</span><span class="p">);</span>
<span class="nv">$this</span>
  <span class="o">-&gt;</span><span class="na">addFieldMapping</span><span class="p">(</span><span class="s1">&#39;field_image:source_dir&#39;</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="na">defaultValue</span><span class="p">(</span><span class="nx">drupal_get_path</span><span class="p">(</span><span class="s1">&#39;module&#39;</span><span class="p">,</span> <span class="s1">&#39;example_migrate&#39;</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;/images&#39;</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>For multiple values in one field, use the separator(&#39;|&#39;) function when defining field mapping:
<img src="/assets/images/legacy/s028.png" /></p>
<div class="highlight"><pre><code class="php language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$this</span>
  <span class="o">-&gt;</span><span class="na">addFieldMapping</span><span class="p">(</span><span class="s1">&#39;field_inventory_line_inline&#39;</span><span class="p">,</span> <span class="s1">&#39;field_inventory_line_inline&#39;</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="na">sourceMigration</span><span class="p">(</span><span class="s1">&#39;exampleInventoryLines&#39;</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="na">separator</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>For additional data tweaking, we can use the <code>prepare()</code>, <code>prepareRow()</code>, and <code>complete()</code> functions.</p>
<div class="highlight"><pre><code class="php language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">complete</span><span class="p">(</span><span class="nv">$entity</span><span class="p">,</span> <span class="nv">$row</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Do something, e.g. flag a flag on the node.</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>After everything is built, we stroll over to the UI (admin/content/migrate) and select what we want to import, and import away. Alternatively, Migrate can run through drush, which you&#39;ll probably want to use when using an installation profile.</p>


          </div>
        </article>
        <section class="post-nav">
          <div class="row">
            <div class="col-xs-6 previous">
              
              <div class="text-uppercase">
                <a href="/content/drupal-nodejs-pantheon-and-heroku/">
                  Previous
                  <span class="visible-xs"> post</span>
                </a>
              </div>
              <a href="/content/drupal-nodejs-pantheon-and-heroku/" class="prev-text">
                <span class="hidden-xs">Drupal, Node.js, Pantheon, and Heroku</span>
              </a>
              
            </div>
            <div class="col-xs-6 next">
              
              <div class="text-uppercase">
                <a href="/content/harvard-openscholar/">
                  Next
                  <span class="visible-xs"> post</span>
                </a>
              </div>
              <a href="/content/harvard-openscholar/" class="next-text">
                <span class="hidden-xs">Harvard's OpenScholar</span>
              </a>
              
            </div>
          </div>
        </section>
        <section class="author-details">
          <div class="image-wrapper">
            <img src="/images/team/avatars/amitaibu.4179.jpg" class="img-circle img-responsive">
          </div>
          <div class="text-wrapper">
            <span class="name">Amitai Burstein</span>
            
              <span class="twitter">(@amitaibu)</span>
            
            <div class="title">CTO, Co-Owner</div>
            <div class="bio">Maintainer of Organic groups, the Message stack, and co-maintainer of Drupal 8's Entity reference. <a href="/content/the-about-story/">The about story</a>.</div>
          </div>
        </section>
        <section>
          <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'gizra';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

        </section>
      </div>
    </div>
  </div>
</div>


    <!--Footer -->
    
  <div id="contact">
    <footer id="footer">
      <div class="footer-wrapper">
        <div class="background">
          <div class="container">
            <div class="row">
              <div class="col-sm-12">
                <h2 class="title">Talk to us</h2>
                <div class="clearfix">
                  <address>
                    <div class="strong">Israel Headquarters</div>
                    <span>5 Brenner St., Tel Aviv</span>
                      <a class="telephone" href="tel:+97233731222">+972-3-3731222</a>
                    <a class="email" href="mailto:info@gizra.com">info@gizra.com</a>
                  </address>
                  <address class="separator">
                    <div class="strong">United States Office</div>
                    <span>1157 Columbus Ave, 4th floor. New York, NY 10023</span>
                      <a class="telephone" href="tel:+13476864508">+1 347 686-4508</a>
                    <a class="email" href="mailto:usoffice@gizra.com">usoffice@gizra.com</a>
                  </address>
                  <div class="separator social-links">
                    <span class="link twitter">
                      <a href="https://twitter.com/gizra_drupal" target="_blank"><i class="fa fa-twitter-square"></i></a>
                    </span>
                    <span class="link linkedin">
                      <a href="https://www.linkedin.com/company/gizra-ltd" target="_blank"><i class="fa fa-linkedin-square"></i></a>
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </footer>
  </div>



    <script src="/js/plugins.7686.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script>

    <script src="/js/scripts.ddd6.js"></script>
      
    <!-- ClickTale Bottom part -->
    
    <script type='text/javascript'>
    // The ClickTale Balkan Tracking Code may be programmatically customized using hooks:
    // 
    //   function ClickTalePreRecordingHook() { /* place your customized code here */  }
    //
    // For details about ClickTale hooks, please consult the wiki page http://wiki.clicktale.com/Article/Customizing_code_version_2
    
    document.write(unescape("%3Cscript%20src='"+
    (document.location.protocol=='https:'?
    "https://cdnssl.clicktale.net/www07/ptc/dea77991-0e38-46cc-a46f-1043e9e6e781.js":
    "http://cdn.clicktale.net/www07/ptc/dea77991-0e38-46cc-a46f-1043e9e6e781.js")+"'%20type='text/javascript'%3E%3C/script%3E"));
    </script>
    
    <!-- ClickTale end of Bottom part -->
    </body>
</html>
