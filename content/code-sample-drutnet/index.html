<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Code sample for DrutNet API - connect, load node, save node and upload file</title>
        <meta name="viewport" content="width=device-width">

        <link rel="stylesheet" href="/css/main.2676.css"/>

        <link href='http://fonts.googleapis.com/css?family=Abril+Fatface' rel='stylesheet' type='text/css'>


    </head>
    <body>

    

    <header class="white">
      <div class="container">
        <div class="logo"><a href="/">gizra</a></div>
        <nav id="nav" role="navigation" class="navbar navbar-default nav-fixed">
          <div class="navbar-header">
            <button data-target=".navbar-collapse" data-toggle="collapse" class="navbar-toggle" type="button">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
          </div>
          <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
              <li><a href="/products">Products</a></li>
              <li><a href="/#about">About</a></li>
              <li><a href="/#work">Work</a></li>
              <li><a href="/#code">Showcase</a></li>
              <li><a href="/blog" class="active">Blog</a></li>
              <li><a href="/#contact">Contact</a></li>
            </ul>
          </div>
        </nav>
      </div> <!-- End of container -->
    </header>

    


    
  



  
    
      
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  


<section id="post-page">
  <div class="background">
    <img src="/images/post/background.2707.png">
  </div>

  <div class="ballons"></div>
  <div class="post-back">
    <a href="/blog">
      <img src="/images/post/post-back.fca6.png">
    </a>
  </div>

  <div class="content">
    <div class="container">
      <div class="row">

        <div class="col-md-12 post">
          <div class="row">
            <div class="post-label col-xs-12">
              <a href="/content/code-sample-drutnet/">Code sample for DrutNet API - connect, load node, save node and upload file</a>
            </div>
          </div>

          <div class="row small-row">
            <div class="date col-md-3 col-sm-3 col-xs-4">17 May 2010</div>
            <div class="seprator col-md-1 col-sm-1 col-xs-1">|</div>
            <div class="author col-md-8 col-sm-7 col-xs-6">By Amitai Burstein</div>
          </div>

          <div class="row small-row">
            <div class="tags col-sm-9">

              
              <ul class="inline">
                
                

  
    
      <li><a href="/tags.html#Drupal-planet-ref">Drupal-planet</a></li>
    
      <li><a href="/tags.html#.NET-ref">.NET</a></li>
    
      <li><a href="/tags.html#DrutNet-ref">DrutNet</a></li>
    
  


              </ul>
              
            </div>

            <div class="comments-count col-sm-3"><a href="http://www.gizra.com/content/code-sample-drutnet/#disqus_thread"></a></div>
          </div>

          <div class="row">
            <div class="col-xs-12 post-content">
              <p>In the previous <a href="/content/drutnet-drupal-net-api">post</a> I&#39;ve introduced DrutNet API with an already compiled example, today I will show some code examples.
Since last post I&#39;ve added a new method that allow file upload with Services, using the base-64 conversion, I will show you how this method works.</p>

<!-- more -->

<ol>
<li>Create a project in your preferred  .Net IDE, I use VS 2008 but those who prefer to work in the open source world can use the <a href= "http://www.mono-project.com" target="_blank">Mono IDE</a> instead.
</li><br></ul>
<li>To work with Services we need two assembly reference,  CookComputing.XmlRpcV2 and obviously Drutnet library (both dll are under  <a href="http://github.com/bricel/DrutNet/tree/master/Dlls/" target ="_blank">Dlls folder</a> stored in GitHub).
</li><br>
<li>Now we need to have a Drupal site with the <a href="http://drupal.org/project/Services" target= "_blank">Services module</a> installed  and the following modules enabled :
<ul>
<li>Services</li>
<li>XMLRPC Server </li>
<li>File Service</li>
<li>Node Service</li></ul>
</li>
<li>After adding the libraries and enabling the modules we can start working, first we need to create an instance of the ServicesSettings class and then of the Sevices class  :
```
 DrutNET.ServicesSettings services_settings= new DrutNET.ServicesSettings();
 services_settings.DrupalURL = @"http://localhost/drupal-6.16/";
 services_settings.UseSessionID = false;
 services_settings.CleanURL = true;
```Here we define the connection settings, which include the path to your Drupal site, the type of security you have enabled in the services settings (only session ID is supported at this point) and clean URL settings.
```
DrutNET.Services service_connection = new DrutNET.Services(service_settings);
```Here we create an instance of the services class using the settings class instance created before.
</li><br>
<li>Now we can login to Drupal :
```
If (service_connection.Login("username", "password"))
  Console.Write("Login successfull");
else
  Console.Write("Login failed");
```* Make sure that the user has permission for all the services functions that you intend to use.
</li><br>
<li>Load and save a node :
```
int nideID = 1;
CookComputing.XmlRpc.XmlRpcStruct node = service_connection.NodeGet(nodeID);
node["body"] = "My new text";
service_connection.NodeSave(node);
```Here we use NodeGet method to load a node and then NodeSave method to save it back after making a change to the body field.
</li><br>
<li>Save a file to a node :
```
 string filePath = @"c:\test.txt";
 int fileIndex = 0; // In case of multiple file field the index of the file.
 int nodeID = 1; // The node to attach the file to.
 string fieldName = "field_file" ; // CCK field name as defined in the content.
 service_connection.FileUpload(filePath , fileIndex , nodeID , fieldName);
```FileUpload method takes care of converting the file to base64 and also used both services FileSave and NodeSave.
</li></ol>

            </div>
          </div>

          <div class="row">
            <div class="col-xs-12 bottom-dash"></div>
          </div>

          <div class="row post-nav">
            <div class="col-xs-6">
              
              <div class="previous">
                <a href="/content/group-intro/">
                  Previous
                </a>
              </div>
              <a href="/content/group-intro/" class="prev-text">
                Group (the new OG) intro
              </a>
              
            </div>
            <div class="col-xs-6">
              
              <div class="next">
                <a href="/content/message-module-and-ctools-plugin/">
                  Next
                </a>
              </div>
              <a href="/content/message-module-and-ctools-plugin/" class="next-text">
                Message module and CTools $plugin
              </a>
              
            </div>
          </div>

          <div class="row author-details">
            <div class="col-md-1 image-wrapper">
              <img src="/images/team/amitaibu.4179.jpg" class="img-responsive">
            </div>
            <div class="col-md-11 text-wrapper">
              <span class="name">Amitai Burstein</span> <span class="twitter">(@amitaibu)</span>
              <div class="title">CTO, Co-Owner</div>
              <div class="bio">Maintainer of Organic groups, the Message stack, and co-maintainer of Drupal 8's Entity reference. <a href="/content/the-about-story/">The about story</a>.</div>
            </div>
          </div>

          <div class="row">
            <div class="col-xs-12 bottom-dash-small"></div>
          </div>

          <div class="row">
            <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'gizra';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

          </div>

        </div>
      </div>
    </div>
  </div>
</section>

<script type="text/javascript">
var disqus_shortname = 'gizra';

/* * * DON'T EDIT BELOW THIS LINE * * */
(function () {
var s = document.createElement('script'); s.async = true;
s.type = 'text/javascript';
s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>




    <script src="/js/plugins.5250.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script>

    <script src="/js/scripts.ccb8.js"></script>

    <!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-6558346-3', 'auto');  // Replace with your property ID.
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


    </body>
</html>
