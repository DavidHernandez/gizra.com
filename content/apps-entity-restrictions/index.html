<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        
    

<title>Drupal, Hippies and Backend Restrictions</title>

        <meta name="description" content="">
        <meta name="keywords" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <!-- Favicon for all platforms -->
      <link rel="apple-touch-icon" sizes="57x57" href="/images/favicons/apple-touch-icon-57x57.3a41.png">
      <link rel="apple-touch-icon" sizes="60x60" href="/images/favicons/apple-touch-icon-60x60.a84d.png">
      <link rel="apple-touch-icon" sizes="72x72" href="/images/favicons/apple-touch-icon-72x72.664d.png">
      <link rel="apple-touch-icon" sizes="76x76" href="/images/favicons/apple-touch-icon-76x76.20fe.png">
      <link rel="apple-touch-icon" sizes="114x114" href=/"images/favicons/apple-touch-icon-114x114.png">
      <link rel="apple-touch-icon" sizes="120x120" href="/images/favicons/apple-touch-icon-120x120.842b.png">
      <link rel="apple-touch-icon" sizes="144x144" href="/images/favicons/apple-touch-icon-144x144.0175.png">
      <link rel="apple-touch-icon" sizes="152x152" href="/images/favicons/apple-touch-icon-152x152.f9ac.png">
      <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon-180x180.f24a.png">
      <link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.c391.png" sizes="32x32">
      <link rel="icon" type="image/png" href="/images/favicons/favicon-194x194.2d07.png" sizes="194x194">
      <link rel="icon" type="image/png" href="/images/favicons/favicon-96x96.8557.png" sizes="96x96">
      <link rel="icon" type="image/png" href="/images/favicons/android-chrome-192x192.6d91.png" sizes="192x192">
      <link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.a93c.png" sizes="16x16">
      <link rel="manifest" href="/images/favicons/manifest.json">
      <meta name="msapplication-TileColor" content="#000000">
      <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
      <meta name="theme-color" content="#ffffff">
      <!-- End favicon for all platforms -->

      <link rel="stylesheet" href="/css/main.1ede.css"/>
      <link href='http://fonts.googleapis.com/css?family=Abril+Fatface' rel='stylesheet' type='text/css'>
      <link href='https://fonts.googleapis.com/css?family=Hind:400,600,300,500' rel='stylesheet' type='text/css'>
      <link href='https://fonts.googleapis.com/css?family=Raleway:400,300,600,800' rel='stylesheet' type='text/css'>
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
      <!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-6558346-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->

      
      <!-- Begin Inspectlet Embed Code -->
      <script type="text/javascript" id="inspectletjs">
      window.__insp = window.__insp || [];
      __insp.push(['wid', 314054580]);
      (function() {
      function ldinsp(){if(typeof window.__inspld != "undefined") return; window.__inspld = 1; var insp = document.createElement('script'); insp.type = 'text/javascript'; insp.async = true; insp.id = "inspsync"; insp.src = ('https:' == document.location.protocol ? 'https' : 'http') + '://cdn.inspectlet.com/inspectlet.js'; var x = document.getElementsByTagName('script')[0]; x.parentNode.insertBefore(insp, x); };
      setTimeout(ldinsp, 500); document.readyState != "complete" ? (window.attachEvent ? window.attachEvent('onload', ldinsp) : window.addEventListener('load', ldinsp, false)) : ldinsp();
      })();
      </script>
      <!-- End Inspectlet Embed Code -->
      
    </head>
    <body>

    <!-- Main content -->
    
  



  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
      
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  


<div id="post-page">
  <header id="header-post">
    <div class="container">
      <div class="row">
        <div class="col-sm-10 col-sm-offset-1">
          
  

<nav id="nav" role="navigation" class="navbar navbar-default">
  <div class="navbar-header">
    <button data-target=".navbar-collapse" data-toggle="collapse" class="navbar-toggle" type="button">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
  </div>
  <div class="navbar-collapse collapse">
    <ul class="nav navbar-nav">
      <li><a href="/#about" class="smooth-scroll-to">About Us</a></li>
      <li><a href="/team">Meet the Team</a></li>
      <li><a href="/blog">Blog</a></li>
      <li><a href="#contact" class="smooth-scroll-to">Contact</a></li>
    </ul>
  </div>
</nav>

  <h2 class="gizra-logo"><a href="/">gizra</a></h2>



        </div>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="row">
      <div class="col-sm-10 col-sm-offset-1">
        <article class="post">
          <h1><a href="/content/apps-entity-restrictions">Drupal, Hippies and Backend Restrictions </a></h1>
          <div class="date">17 Jan 2016, By Roy Segall</div>
          <div class="tags">
            <img src="/images/post/tag-icon-small.15a8.png" class="tags-icon"/>
            <ul class="inline">
              
              

  
    
      <li><a href="/tags.html#Restful-ref">Restful</a></li>
    
      <li><a href="/tags.html#Drupal-planet-ref">Drupal-planet</a></li>
    
  


            </ul>
            </div>
          <div class="post-content">

            <p>You might have heard of <a href="http://burningman.org/">Burning Man</a>. Basically it&#39;s a lot of hippies settling down in the desert for a few days, setting up small camps with diffrent themes that make up a big, temporary city.</p>

<p>It&#39;s not for me.</p>

<div class="thumbnail">
  <img src="http://www.gizra.com/assets/images/posts/apps-entity-restrictions/burner.jpg">
  <div class="caption">Radical Self-expression is one of <a href="http://midburn.org/en-ten-principles/">Midburn ten principles</a>. &#169; Eyal Levkovich.</div>
</div>

<!-- more -->

<p>And yet, I found myself going to the hackathon of our local Burning man community as an enthusiastic Drupal developer willing to solve any Drupal issue (and you can assume they had a few). My part was to write the backend, and the obvious choice was using the <a href="https://github.com/RESTful-Drupal/restful">RESTful</a> module.</p>

<p>Soon I came across a big problem: How can we manage 3rd party applications and make sure they can&#39;t access resources which they shouldn&#39;t have access to?<br>
How can we prevent the Secret Santa application (an app that provides addresses of other Burning Man attendees so they could receive gifts) from accessing a user&#39;s medical qualification data?
Or prevent the Midburn questionnaire application from accessing attendees private data?</p>

<div class="thumbnail">
    <iframe src="http://gfycat.com/ifr/FragrantUnequaledHerculesbeetle" frameborder="0" scrolling="no" width="800" height="600" style="-webkit-backface-visibility: hidden;-webkit-transform: scale(1);" ></iframe>
  <div class="caption">Apps Entity Restrictions in action</div>
</div>

<p><a href="https://github.com/RoySegall/apps_entity_restrictions">Apps Entity Restrictions</a> is our answer to the problem.</p>

<p>With this module, which I developed, you can create 3rd party application representation where you can determine which field or property each registered application can access on each entity. You can even restrict the allowed CRUD operations.</p>

<p>While working on Gizra&#39;s modules and projects in the past years I came to realize that a good API and a good DX is the one thing responsible for a good module. By default, any app is restricted from doing any operation - you know, security.</p>

<p>Progrmatically creating an application with allowed <code>GET</code> operation on the body and the node ID is as you would might expect it to be:</p>
<div class="highlight"><pre><code class="php language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$app</span>
  <span class="o">-&gt;</span><span class="na">setTitle</span><span class="p">(</span><span class="s1">&#39;Demo application&#39;</span><span class="p">)</span>
  <span class="c1">// Allow only GET operations.</span>
  <span class="o">-&gt;</span><span class="na">allow</span><span class="p">(</span><span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="s1">&#39;methods&#39;</span><span class="p">,</span> <span class="s1">&#39;get&#39;</span><span class="p">)</span>
  <span class="c1">// Explicitly allow access to both properties/ fields.</span>
  <span class="o">-&gt;</span><span class="na">allow</span><span class="p">(</span><span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="s1">&#39;properties&#39;</span><span class="p">,</span> <span class="s1">&#39;nid&#39;</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="na">allow</span><span class="p">(</span><span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="s1">&#39;properties&#39;</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</code></pre></div>
<p>Checking those restriction via code is easy:</p>
<div class="highlight"><pre><code class="php language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="c1">// Check property access.</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">entityPropertyAccess</span><span class="p">(</span><span class="s1">&#39;get&#39;</span><span class="p">,</span> <span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="s1">&#39;field_address&#39;</span><span class="p">))</span> <span class="p">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nx">\Exception</span><span class="p">(</span><span class="s2">&quot;This app has no GET access to the address field.&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h2>Restful Integration and Other bonuses</h2>

<p>There is a cool and easy Restful integration. The module provides a set of
<a href="https://github.com/RoySegall/apps_entity_restrictions#restful-integration">API</a>
for developers to get this restriction validation on their endpoint. If you&#39;re interested in Decoupled Drupal, you should probably take a look at this.</p>

<p>The next step is baking in some more statistics. Wouldn&#39;t it be great if you could know the usage stats for each application? Apart from knowing usage patterns, having information like, for example, amount of <em>invalid</em> requests might help in detecting intrusion attempts.</p>

<div class="thumbnail">
  <img src="http://www.gizra.com/assets/images/posts/apps-entity-restrictions/image1.jpg">
  <div class="caption">Requests graphs. Cool, right?</div>
</div>


          </div>
        </article>
        <section class="post-nav">
          <div class="row">
            <div class="col-xs-6 previous">
              
              <div class="text-capitalize">
                <a href="/content/elm-hedley-overview">
                  Previous
                  <span class="visible-xs"> post</span>
                </a>
              </div>
              <a href="/content/elm-hedley-overview" class="prev-text">
                <span class="hidden-xs">Elm-Hedley, App Overview</span>
              </a>
              
            </div>
            <div class="col-xs-6 next">
              
              <div class="text-capitalize">
                <a href="/content/entity-relationships">
                  Next
                  <span class="visible-xs"> post</span>
                </a>
              </div>
              <a href="/content/entity-relationships" class="next-text">
                <span class="hidden-xs">Entity Relationships Graph</span>
              </a>
              
            </div>
          </div>
        </section>
        <section class="author-details">
          <div class="image-wrapper">
            <img src="/images/team/avatars/RoySegall.a616.jpg" class="img-circle img-responsive">
          </div>
          <div class="text-wrapper">
            <span class="name">Roy Segall</span>
            
            <div class="title">Team Lead</div>
            <div class="bio">Not afraid of patching Organic groups, Entity reference or the Message stack. Knows how to make tasty Pizza.</div>
          </div>
        </section>
        <section>
          <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'gizra';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

        </section>
      </div>
    </div>
  </div>
</div>


    <!--Footer -->
    
  <div id="contact">
    <footer id="footer">
      <div class="footer-wrapper">
        <div class="background">
          <div class="container">
            <div class="row">
              <div class="col-sm-12">
                <h2 class="title">Talk to us</h2>
                <div class="clearfix">
                  <address>
                    <div class="strong">Israel Headquarters</div>
                    <span>5 Brenner Street, Tel Aviv</span>
                      <a class="telephone" href="tel:+97233731222">+972-3-3731222</a>
                    <a class="email" href="mailto:info@gizra.com">info@gizra.com</a>
                  </address>
                  <address class="separator">
                    <div class="strong">United States Office</div>
                    <span>157 Columbus Avenue, 4th Floor, New York, NY 10023</span>
                    <a class="telephone" href="tel:+13476864508">347-686-4508</a>
                    <a class="email" href="mailto:usoffice@gizra.com">usoffice@gizra.com</a>
                  </address>
                  <div class="separator social-links">
                    <span class="link github">
                      <a href="https://github.com/Gizra" target="_blank"><i class="fa fa-github-square"></i></a>
                    </span>
                    <span class="link twitter">
                      <a href="https://twitter.com/gizra_drupal" target="_blank"><i class="fa fa-twitter-square"></i></a>
                    </span>
                    <span class="link linkedin">
                      <a href="https://www.linkedin.com/company/gizra-ltd" target="_blank"><i class="fa fa-linkedin-square"></i></a>
                    </span>
                    <span class="link facebook">
                      <a href="https://www.facebook.com/gizraltd/timeline" target="_blank"><i class="fa fa-facebook-square"></i></a>
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </footer>
  </div>



    <script src="/js/plugins.c51b.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script>

    <script src="/js/scripts.ddd6.js"></script>
    </body>
</html>
