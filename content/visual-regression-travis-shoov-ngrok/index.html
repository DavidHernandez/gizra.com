<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Visual regression tests on every commit</title>
        <meta name="viewport" content="width=device-width">

      <!-- Favicon for all platforms -->
      <link rel="apple-touch-icon" sizes="57x57" href="/images/favicons/apple-touch-icon-57x57.b3df.png">
      <link rel="apple-touch-icon" sizes="60x60" href="/images/favicons/apple-touch-icon-60x60.a84d.png">
      <link rel="apple-touch-icon" sizes="72x72" href="/images/favicons/apple-touch-icon-72x72.664d.png">
      <link rel="apple-touch-icon" sizes="76x76" href="/images/favicons/apple-touch-icon-76x76.faf5.png">
      <link rel="apple-touch-icon" sizes="114x114" href=/"images/favicons/apple-touch-icon-114x114.png">
      <link rel="apple-touch-icon" sizes="120x120" href="/images/favicons/apple-touch-icon-120x120.d810.png">
      <link rel="apple-touch-icon" sizes="144x144" href="/images/favicons/apple-touch-icon-144x144.1807.png">
      <link rel="apple-touch-icon" sizes="152x152" href="/images/favicons/apple-touch-icon-152x152.71bf.png">
      <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon-180x180.a9f0.png">
      <link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.c391.png" sizes="32x32">
      <link rel="icon" type="image/png" href="/images/favicons/favicon-194x194.e5f8.png" sizes="194x194">
      <link rel="icon" type="image/png" href="/images/favicons/favicon-96x96.8557.png" sizes="96x96">
      <link rel="icon" type="image/png" href="/images/favicons/android-chrome-192x192.0b72.png" sizes="192x192">
      <link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.7353.png" sizes="16x16">
      <link rel="manifest" href="/images/favicons/manifest.json">
      <meta name="msapplication-TileColor" content="#000000">
      <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
      <meta name="theme-color" content="#ffffff">
      <!-- End favicon for all platforms -->

        <link rel="stylesheet" href="/css/main.0447.css"/>

        <link href='http://fonts.googleapis.com/css?family=Abril+Fatface' rel='stylesheet' type='text/css'>

        <!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-6558346-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


    </head>
    <body>

    

    <header class="white">
      <div class="container">
        <div class="logo"><a href="/">gizra</a></div>
        <nav id="nav" role="navigation" class="navbar navbar-default nav-fixed">
          <div class="navbar-header">
            <button data-target=".navbar-collapse" data-toggle="collapse" class="navbar-toggle" type="button">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
          </div>
          <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
              <li><a href="/#work">Work</a></li>
              <li><a href="/#about">About</a></li>
              <li><a href="/blog">Blog</a></li>
              <li><a href="/team">Team</a></li>
              <li><a href="/#contact">Contact</a></li>
            </ul>
          </div>
        </nav>
      </div> <!-- End of container -->
    </header>

    


    
  



  
    
      
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  


<section id="post-page">
  <div class="background">
    <img src="/images/post/background.71f5.png">
  </div>

  <div class="ballons"></div>
  <div class="post-back">
    <a href="/blog">
      <img src="/images/post/post-back.fca6.png">
    </a>
  </div>

  <div class="content">
    <div class="container">
      <div class="row">

        <div class="col-md-8 col-md-offset-2 post">
          <div class="row">
            <div class="post-label">
              <a href="/content/visual-regression-travis-shoov-ngrok">Visual regression tests on every commit</a>
            </div>
          </div>

          <div class="row small-row">
            <div class="date">20 May 2015</div>
            <div class="seprator">|</div>
            <div class="author">By Amitai Burstein</div>
          </div>

          <div class="row small-row">
            <div class="tags">

              
              <ul class="inline">
                
                

  
    
      <li><a href="/tags.html#Shoov-ref">Shoov</a></li>
    
      <li><a href="/tags.html#Visual regression-ref">Visual regression</a></li>
    
      <li><a href="/tags.html#Drupal-planet-ref">Drupal-planet</a></li>
    
  


              </ul>
              
            </div>

            <div class="comments-count"><a href="http://www.gizra.com/content/visual-regression-travis-shoov-ngrok#disqus_thread"></a></div>
          </div>

          <div class="row">
            <div class="post-content">
              <p>As we dive deeper into visual regression testing in our development workflow we realize a sad truth: on average, we break our own CSS every week and a half.</p>

<p>Don&#39;t feel bad for us, as in fact I&#39;d argue that it&#39;s pretty common across all web projects - they just don&#39;t know it.  It seems we all need a system that will tell us when we break our CSS.</p>

<p>While we don&#39;t know of a single (good) system that does this, we were able to connect together a few (good) systems to get just that, with the help of:
Travis-CI, <a href="https://github.com/webdriverio/webdrivercss">webdriverCSS</a>, <a href="http://shoov.io/">Shoov.io</a>, BrowserStack/Sauce Labs, and <a href="https://ngrok.com/">ngrok</a>. Oh my!</p>

<p>Don&#39;t be alarmed by the long list. Each one of these does one thing very well, and combining them together was proven to be not too complicated, nor too costly.</p>

<p>You can jump right into the <a href="https://github.com/Gizra/Gizra/blob/master/.travis.yml">.travis</a> file of the Gizra repo to see its configuration, or check the <a href="https://github.com/Gizra/Gizra/blob/master/ui-tests/test/tests.js#L36-L37">webdriverCSS</a> test. Here&#39;s the high level overview of what we&#39;re doing:</p>

<p><a href="http://gizra.com">Gizra.com</a> is built on Jekyll but visual regression could be executed on every site, regardless of the underlying technology. Travis is there to help us build a local installation. Travis also allows adding encrypted keys, so even though the repo is public, we were able to add our Shoov.io and ngrok access tokens in a secure way.</p>

<p>We want to use services such as <a href="http://www.browserstack.com/">BrowserStack</a> or <a href="https://saucelabs.com/">Sauce-Labs</a> to test our local installation on different browsers (e.g. latest chrome and IE11). For that we need to have an external URL accessible by the outside world, which is where ngrok comes in: <code>ngrok http -log=stdout -subdomain=$TRAVIS_COMMIT 9000</code> from the <code>.travis.yml</code> file exposes our Jekyll site inside the Travis box to a unique temporary URL based on the Git commit (e.g. <code>https://someCommitHash.ngrok.io</code>).</p>

<p>WebdriverCSS tests are responsible for capturing the screenshots, and comparing them against the baseline images. If a regression is found, it will be automatically pushed to Shoov, and a link to the regression would be provided in the Travis log. This means that if a test was broken, we can immediately see where&#39;s the regression and figure out if it is indeed a bug - or, if not, replace the baseline image with the &quot;regression&quot; image.</p>

<div class="thumbnail">
  <img src="http://www.gizra.com/assets/images/posts/shoov-travis/image1.jpg">
  <div class="caption">Visual regression found and uploaded to shoov.io</div>
</div>

<!-- more -->

<h2>Caveats</h2>

<p>Some gotchas to be aware of:</p>

<p>Even though visual regression testing with BrowserStack or Sauce Labs takes more time than running it on PhantomJS, it&#39;s recommended to use such tools, since they test your site against <em>real</em> browsers.  </p>

<p>Those tools cost money, but we find that it&#39;s well worth it. We are currently using BrowserStack (99$/month), though we&#39;re running into some issues with it not having an internal queue system - so if you reached your limit on virtual hosts concurrency, your tests will simply fail. For that reason we might switch to Sauce Labs (149$/month) which also provides more concurrent VMs.</p>

<div class="thumbnail">
  <img src="http://www.gizra.com/assets/images/posts/shoov-travis/image2.jpg">
  <div class="caption">Blog post page tested on IE11, Windows 7</div>
</div>

<p>Travis is limited to 50 minutes&#39; execution time. Capturing each image might take about 30 - 90 sec, so when you reach lots of tests, you should probably split them.</p>

<p>The free plan of ngrok allows only a single concurrent tunnel to be opened. Even though BroswerStack and Sauce Labs provide their own tunneling solution, we decided to go with ngrok, in order to provide a more generic solution. We happily upgraded to the $25/month business account following our excellent experience with the free account.</p>

            </div>
          </div>

          <div class="row">
            <div class="bottom-dash"></div>
          </div>

          <div class="row post-nav">
            <div class="first">
              
              <div class="previous">
                <a href="/content/shoov-monitor-twitter">
                  Previous
                </a>
              </div>
              <a href="/content/shoov-monitor-twitter" class="prev-text">
                How we could monitor Twitter (if we had to)
              </a>
              
            </div>
            <div class="last">
              
              <div class="next">
                <a href="/content/restful-backbone-marionette">
                  Next
                </a>
              </div>
              <a href="/content/restful-backbone-marionette" class="next-text">
                Forking Todo Restful with Backbone.Marionette
              </a>
              
            </div>
          </div>

          <div class="row author-details">
            <div class="image-wrapper">
              <img src="/images/team/amitaibu.4179.jpg" class="img-responsive">
            </div>
            <div class="text-wrapper">
              <span class="name">Amitai Burstein</span> <span class="twitter">(@amitaibu)</span>
              <div class="title">CTO, Co-Owner</div>
              <div class="bio">Maintainer of Organic groups, the Message stack, and co-maintainer of Drupal 8's Entity reference. <a href="/content/the-about-story/">The about story</a>.</div>
            </div>
          </div>

          <div class="row">
            <div class="bottom-dash-small"></div>
          </div>

          <div class="row">
            <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'gizra';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

          </div>

        </div>
      </div>
    </div>
  </div>
</section>

<script type="text/javascript">
var disqus_shortname = 'gizra';

/* * * DON'T EDIT BELOW THIS LINE * * */
(function () {
var s = document.createElement('script'); s.async = true;
s.type = 'text/javascript';
s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>




    <script src="/js/plugins.b01d.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script>

    <script src="/js/scripts.d40a.js"></script>

    </body>
</html>
