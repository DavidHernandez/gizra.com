<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        
    

<title>OG7 and Entity reference - Part 2</title>

        <meta name="description" content="">
        <meta name="keywords" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <!-- Favicon for all platforms -->
      <link rel="apple-touch-icon" sizes="57x57" href="/images/favicons/apple-touch-icon-57x57.b3df.png">
      <link rel="apple-touch-icon" sizes="60x60" href="/images/favicons/apple-touch-icon-60x60.a84d.png">
      <link rel="apple-touch-icon" sizes="72x72" href="/images/favicons/apple-touch-icon-72x72.664d.png">
      <link rel="apple-touch-icon" sizes="76x76" href="/images/favicons/apple-touch-icon-76x76.faf5.png">
      <link rel="apple-touch-icon" sizes="114x114" href=/"images/favicons/apple-touch-icon-114x114.png">
      <link rel="apple-touch-icon" sizes="120x120" href="/images/favicons/apple-touch-icon-120x120.d810.png">
      <link rel="apple-touch-icon" sizes="144x144" href="/images/favicons/apple-touch-icon-144x144.1807.png">
      <link rel="apple-touch-icon" sizes="152x152" href="/images/favicons/apple-touch-icon-152x152.71bf.png">
      <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon-180x180.a9f0.png">
      <link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.c391.png" sizes="32x32">
      <link rel="icon" type="image/png" href="/images/favicons/favicon-194x194.e5f8.png" sizes="194x194">
      <link rel="icon" type="image/png" href="/images/favicons/favicon-96x96.8557.png" sizes="96x96">
      <link rel="icon" type="image/png" href="/images/favicons/android-chrome-192x192.0b72.png" sizes="192x192">
      <link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.7353.png" sizes="16x16">
      <link rel="manifest" href="/images/favicons/manifest.json">
      <meta name="msapplication-TileColor" content="#000000">
      <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
      <meta name="theme-color" content="#ffffff">
      <!-- End favicon for all platforms -->

      <link rel="stylesheet" href="/css/main.7ce6.css"/>
      <link href='http://fonts.googleapis.com/css?family=Abril+Fatface' rel='stylesheet' type='text/css'>
      <link href='https://fonts.googleapis.com/css?family=Hind:400,600,300,500' rel='stylesheet' type='text/css'>
      <link href='https://fonts.googleapis.com/css?family=Raleway:400,300,600,800' rel='stylesheet' type='text/css'>
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
      <!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-6558346-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->

              
    </head>
    <body>
    <!-- ClickTale Top part -->
    <script type="text/javascript">
    var WRInitTime=(new Date()).getTime();
    </script>
    <!-- ClickTale end of Top part -->

    <!-- Main content -->
    
  



  
    
      
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  


<div id="post-page">
  <header id="header-post">
    <div class="container">
      <div class="row">
        <div class="col-sm-10 col-sm-offset-1">
          
  

<nav id="nav" role="navigation" class="navbar navbar-default">
  <div class="navbar-header">
    <button data-target=".navbar-collapse" data-toggle="collapse" class="navbar-toggle" type="button">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
  </div>
  <div class="navbar-collapse collapse">
    <ul class="nav navbar-nav">
      <li><a href="/#about" class="smooth-scroll-to">About us</a></li>
      <li><a href="/team">Meet the team</a></li>
      <li><a href="/blog">Blog</a></li>
      <li><a href="#contact" class="smooth-scroll-to">Contact</a></li>
    </ul>
  </div>
</nav>

  <h2 class="gizra-logo"><a href="/">gizra</a></h2>



        </div>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="row">
      <div class="col-sm-10 col-sm-offset-1">
        <article class="post">
          <h1><a href="/content/og7-and-entity-reference-part-2/">OG7 and Entity reference - Part 2 </a></h1>
          <div class="date">07 Dec 2011, By Amitai Burstein</div>
          <div class="tags">
            <img src="/images/post/tag-icon-small.15a8.png" class="tags-icon"/>
            <ul class="inline">
              
              

  
    
      <li><a href="/tags.html#Drupal-planet-ref">Drupal-planet</a></li>
    
      <li><a href="/tags.html#OG7-ref">OG7</a></li>
    
  


            </ul>
            </div>
          <div class="post-content">

            <p>Following my <a href="http://www.gizra.com/content/og7-and-entity-reference-sponsor-me">previous</a> post, and after getting some great reaction from the community via IRC and in Drupalcamp Toulouse, I’d like to share both my thoughts about the sponsoring and about the technical stuff.</p>

<p>The sponsoring, which already has <a href="http://funnymonkey.com/">FunnyMonkey</a> committing to pay almost half the price, and providing on top of that developer hours, was something I’ve decided to do only after I was convinced there are some big players using OG7.
The thing is that _anyway I intend to do this change. The sponsoring is just giving it a boost, and making sure it will be _sooner than later!</p>

<p>I’m happy I was able to post that request and to get good reaction from the community.
I’m equally happy that Planet Drupal isn’t swamped with such requests. It’s not about Drupal App. It’s about harnessing the community towards a goal. Companies offering to assist by providing developer hours is exactly the proof of that.</p>

<p>Now here’s a quick overview of the planned changes. First the conceptual changes:
<ul>
<li>Instead of OG having it&#39;s own field type, we easily hook into Entity reference field, as it allows registering our own handler using a CTools plugin</li>
<li>Instead of saving the field values <em>and the OG membership as we currently do, we save the OG membership, and use hook</em>field<em>load() to populate the Entity reference with the correct value. Yes, I know, the docs clearly say that we should not load fieldable entities in hook</em>field_load() as it might cause loading recursion, so we&#39;ll just make sure you can&#39;t attach group-audience fields to OG membership (which anyway doesn&#39;t make much sense). The benefit of doing that, after a long talk with the people form the community, notably fago (thanks again fago!), came out as the best solution for a problematic thing</li>
<li>OG membership is now tightly coupled with the field that it belongs to. This means we can care about the field cardinality (i.e. how many OG membership can be created per field), and since we know the OG membership type we can provide smarter metadata</li>
<li>We can have multiple fields, to allow subscribing users/ content to group with different membership type. No more hard-coding of the field name as-well</li>
</ul></p>

<p>Sneak preview time...
As usual we can make a content type (Clubs in this example) a group, through the content type edit.</p>

<!-- more -->

<p><img src="/assets/images/legacy/1.jpg" /></p>

<p>In the new version, when you want to make a content type (Post in this example) a group content, you immediately select to which group entity type, and optionally bundle the field should point. Making the reference to only a single entity type, allows us to have really simple integration with other modules (e.g. Views, Tokens, Rules) that expect the field value to be of the same entity type.</p>

<p><img src="/assets/images/legacy/2.jpg" /></p>

<p>No more OG&#39;s own field -- this is just another Entity reference field.</p>

<p><img src="/assets/images/legacy/3.jpg" /></p>

<p>In the field settings, we select OG&#39;s handler for Entity reference, where we can define different OG related settings.
The &quot;My groups&quot; checkbox indicates the reference should show the user only groups they are member of.</p>

<p><img src="/assets/images/legacy/4.jpg" /></p>

<p>As we can attach multiple fields, it means the My group/ Other groups administrators used to see in the group-audience field, is no longer needed.</p>

<p><img src="/assets/images/legacy/5.jpg" /></p>

<p>Best practice will probably be, show one field set to &quot;My group&quot; as select list, and another field for groups a user doesn&#39;t belong to as autocomplete (finally solving performance issues when there are lots of groups).
The primary field option, is better shown by example.</p>

<p><img src="/assets/images/legacy/6.jpg" /></p>

<p>In this Post node, we can see the two fields. Remember, the groups shown in the My groups/ Other groups are user specific.</p>

<p><img src="/assets/images/legacy/7_0.jpg" /></p>

<p>After selecting one group from each field and saving, we see that the values have &quot;jumped&quot; from the secondary field to the primary, making sure all our OG memberships are associated with a single field.</p>

<p><img src="/assets/images/legacy/8.jpg" /></p>

<p>Looking in Devel&#39;s output we see the field values. Those values are not stored in the field&#39;s storage, they were populated based on the OG membership associated with the field. For those using Entity metadata wrapper, this means you can do (assuming your field is called og_ref) cool things like:</p>

<p>Getting the groups (i.e. the node that is a group) from a field
<code>$wrapper-&gt;og_ref-&gt;value();</code></p>

<p>Getting the OG membership from a field
<code>$wrapper-&gt;og_ref__og_membership-&gt;value();</code></p>

<p><img src="/assets/images/legacy/9.jpg" /></p>

<p>The last image isn&#39;t related to Entity reference, but since we are about the overhaul stuff, well... We now have global roles and permissions per bundle. This means that if you have a content type called Clubs which is a group, it can have different default OG roles and OG permissions from a group called Restaurants. And we can Copy from the &quot;super&quot; global roles and permissions to the per bundle. Handy!</p>

<p><img src="/assets/images/legacy/10.jpg" /></p>


          </div>
        </article>
        <section class="post-nav">
          <div class="row">
            <div class="col-xs-6 previous">
              
              <div class="text-capitalize">
                <a href="/content/og7-and-entity-reference-sponsor-me/">
                  Previous
                  <span class="visible-xs"> post</span>
                </a>
              </div>
              <a href="/content/og7-and-entity-reference-sponsor-me/" class="prev-text">
                <span class="hidden-xs">OG7 and Entity reference - Sponsor me</span>
              </a>
              
            </div>
            <div class="col-xs-6 next">
              
              <div class="text-capitalize">
                <a href="/content/message-notify-multilingual-email-notifications/">
                  Next
                  <span class="visible-xs"> post</span>
                </a>
              </div>
              <a href="/content/message-notify-multilingual-email-notifications/" class="next-text">
                <span class="hidden-xs">Message notify - Multilingual email notifications</span>
              </a>
              
            </div>
          </div>
        </section>
        <section class="author-details">
          <div class="image-wrapper">
            <img src="/images/team/avatars/amitaibu.4179.jpg" class="img-circle img-responsive">
          </div>
          <div class="text-wrapper">
            <span class="name">Amitai Burstein</span>
            
              <span class="twitter">(@amitaibu)</span>
            
            <div class="title">CTO, Co-Owner</div>
            <div class="bio">Maintainer of Organic groups, the Message stack, and co-maintainer of Drupal 8's Entity reference. <a href="/content/the-about-story/">The about story</a>.</div>
          </div>
        </section>
        <section>
          <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'gizra';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

        </section>
      </div>
    </div>
  </div>
</div>


    <!--Footer -->
    
  <div id="contact">
    <footer id="footer">
      <div class="footer-wrapper">
        <div class="background">
          <div class="container">
            <div class="row">
              <div class="col-sm-12">
                <h2 class="title">Talk to us</h2>
                <div class="clearfix">
                  <address>
                    <div class="strong">Israel Headquarters</div>
                    <span>5 Brenner St., Tel Aviv</span>
                      <a class="telephone" href="tel:+97233731222">+972-3-3731222</a>
                    <a class="email" href="mailto:info@gizra.com">info@gizra.com</a>
                  </address>
                  <address class="separator">
                    <div class="strong">United States Office</div>
                    <span>1157 Columbus Ave, 4th floor. New York, NY 10023</span>
                      <a class="telephone" href="tel:+13476864508">+1 347 686-4508</a>
                    <a class="email" href="mailto:usoffice@gizra.com">usoffice@gizra.com</a>
                  </address>
                  <div class="separator social-links">
                    <span class="link github">
                      <a href="https://github.com/Gizra" target="_blank"><i class="fa fa-github-square"></i></a>
                    </span>
                    <span class="link twitter">
                      <a href="https://twitter.com/gizra_drupal" target="_blank"><i class="fa fa-twitter-square"></i></a>
                    </span>
                    <span class="link linkedin">
                      <a href="https://www.linkedin.com/company/gizra-ltd" target="_blank"><i class="fa fa-linkedin-square"></i></a>
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </footer>
  </div>



    <script src="/js/plugins.7686.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script>

    <script src="/js/scripts.ddd6.js"></script>
      
    <!-- ClickTale Bottom part -->
    
    <script type='text/javascript'>
    // The ClickTale Balkan Tracking Code may be programmatically customized using hooks:
    // 
    //   function ClickTalePreRecordingHook() { /* place your customized code here */  }
    //
    // For details about ClickTale hooks, please consult the wiki page http://wiki.clicktale.com/Article/Customizing_code_version_2
    
    document.write(unescape("%3Cscript%20src='"+
    (document.location.protocol=='https:'?
    "https://cdnssl.clicktale.net/www07/ptc/dea77991-0e38-46cc-a46f-1043e9e6e781.js":
    "http://cdn.clicktale.net/www07/ptc/dea77991-0e38-46cc-a46f-1043e9e6e781.js")+"'%20type='text/javascript'%3E%3C/script%3E"));
    </script>
    
    <!-- ClickTale end of Bottom part -->
    </body>
</html>
